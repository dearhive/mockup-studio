"use strict";var undef=void 0;(function(e){var t=function(){function e(e){var t=this.domElement=document.createElement("div");t.className="panel";t.textContent=e}e.prototype.bind=function(e,t){var i=this.domElement;i.on(e,t);return this};e.prototype.add=function(){for(var t=0;t<arguments.length;t++){var i=arguments[t];if(i!==undef){if(i instanceof e&&i.domElement!==undef){this.domElement.appendChild(i.domElement)}else{console.error("Panel:",i," is not a valid panel.")}}}return this};return e}({});var i=function(e){__extends(t,e);function t(t,i,n){e.call(this,t);$(this.domElement).addClass("menu");this.domElement.textContent="";this.title=t;if(n!==undef){var o=document.createElement("span");o.className="shortcut";o.textContent=n;this.domElement.appendChild(o)}var a=document.createElement("span");a.className="title";a.textContent=t;this.domElement.appendChild(a);if(i!==undef)i.add(this);this._disabled=0;return this}function i(e){if(e.subDom==undef){e.subDom=document.createElement("div");e.subDom.className="submenus";e.domElement.appendChild(e.subDom);$(e.domElement).addClass("hasChild")}}t.prototype.add=function(){i(this);for(var e=0;e<arguments.length;e++){var n=arguments[e];if(n!==undef){if(n instanceof t&&n.domElement!==undef){this.subDom.appendChild(n.domElement);$(n.domElement).addClass("submenu");$(n.domElement).removeClass("menu")}else{console.error("Menu:",n," is not a valid menu.")}}}return this};t.prototype.addSeparator=function(){i(this);this.subDom.appendChild(document.createElement("hr"))};t.prototype.disabled=function(e){if(e===undef){return this._disabled}else{this._disabled=e;if(this._disabled)$(this.domElement).addClass("disabled");else $(this.domElement).removeClass("disabled")}};t.prototype.value=function(e){$(this.domElement).find("> .menu-value").remove();if(e!==undef&&e.trim()!=="")$(this.domElement).append('<span class="menu-value">'+e+"</span>")};return t}(t);var n=function(){var e=function(){var e=this};e.prototype.signIn=function(e){var i=this;return new Promise(function(n,o){chrome.identity.getAuthToken({interactive:e},function(e){t(e).then(function(e){i.setToken(e);n()},function(e){o(e)})})})};function t(e){return new Promise(function(t,i){if(chrome.runtime.lastError){i(e)}else{t(e)}})}e.prototype.setToken=function(e){this.token=e;if(window.gapi&&window.gapi.auth)gapi.auth.setToken({access_token:e})};e.prototype.signOut=function(){var e=this;return new Promise(function(t,i){chrome.identity.removeCachedAuthToken({token:editor.user.token},function(){var i=new XMLHttpRequest;i.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+editor.user.token);i.send();e.setToken();t()})})};e.prototype.getAuthTokenSilent=function(e){r({interactive:false,callback:d})};e.prototype.getProfile=function(){var e=this;return new Promise(function(t,i){gapi.client.request({path:"/plus/v1/people/me",method:"GET",headers:{Authorization:"Bearer "+e.token}}).then(function(e){editor.user.name=e.result.displayName;editor.user.imageUrl=e.result.image.url;t(e)})})};function i(e){if(e[google.picker.Response.ACTION]==google.picker.Action.PICKED){var t=e[google.picker.Response.DOCUMENTS][0];var i={id:t[google.picker.Document.ID],name:t[google.picker.Document.NAME]};if(t.type=="folder"){editor.user.folder=i;chrome.storage.sync.set({googleDriveFolder:editor.user.folder});a()}else if(t.type=="file"){if(t.mimeType.indexOf("json")>-1){var n=gapi.client.request({path:"/drive/v2/files/"+i.id+"?alt=media",method:"GET",headers:{Authorization:"Bearer "+editor.user.token}}).then(function(e){var t=e.result;function n(){swal.close();editor.reset();editor.user.file=i;editor.currentFileName=i.name;editor.updateTitle();editor.fromJSON(t)}if(t.stage==void 0){t=JSON.parse(t)}if(t.stage==void 0){swal({title:"Invalid File...",text:"The selected file ('"+i.name+"') is invalid or currupted.",confirmButtonColor:editor.colors.red,confirmButtonText:"Use File Anyway!",closeOnConfirm:true},function(e){if(e){n()}})}else{n()}},function(e){swal.close();console.log("Could not load file:"+e)});swal({title:"Loading data...",text:"Loading : "+i.name,showConfirmButton:false})}}}}function n(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState===4){if(t.status===200){e.callback(JSON.parse(t.responseText))}else{console.log("get",t.readyState,t.status,t.responseText)}}else{}};t.open("GET",e.url,true);t.setRequestHeader("Authorization","Bearer "+e.token);t.send()}function o(e){n({url:"https://www.googleapis.com/plus/v1/people/me",callback:s,token:e});if(window.gapi&&window.gapi.auth)gapi.auth.setToken({access_token:e});chrome.storage.sync.get("googleDriveFolder",function(e){if(e!==undef){editor.user.folder=e.googleDriveFolder;a()}});showLogin(false);editor.user.token=e}function a(){setDirectory.value("Current Location: "+editor.user.folder.name);loadGoogleDriveMenu.value("Current Location: "+editor.user.folder.name)}function s(e){editor.user.name=e.displayName;editor.user.imageUrl=e.image.url;logOutMenu.value(editor.user.name);userMenu.value("Logged in as: "+editor.user.name);$(menuBar.domElement).find(".login-profile-icon").remove();$(menuBar.domElement).prepend('<img class="login-profile-icon" src="'+editor.user.imageUrl+'" title="Logged in as: '+editor.user.name+'">')}function r(e){chrome.identity.getAuthToken({interactive:e.interactive},e.callback)}function l(){r({interactive:false,callback:d})}function d(e){if(chrome.runtime.lastError){showLogin(true);console.log("User not authorized")}else{o(e)}}function u(){r({interactive:true,callback:c})}function c(e){if(chrome.runtime.lastError){showLogin(true);console.log("User not authorized")}else{o(e)}}return e}({});e.Editor=function(){function o(t,i){var o=this;(function d(e){e.defaultObject=undef;e.colors={blue:"#2fa1d6",gray:"#888",blueActive:"#2B8CB8",red:"#DD6B55",green:"#63af5b"};e.testWidth=1920;e.imageSizes={Default:{width:3e3,height:2e3},"Default ScaleDown":{width:1500,height:1e3},"Full HD":{width:1920,height:1080},HD:{width:1280,height:720},"Dribble @2x":{width:800,height:600}};e.imageQuality=.99;e.thumbnailQuality=.98;e.skipPropertyUpdate=false;e.untitledFileName="*Untitled";e.currentFileName=e.getNewFileName();e.mouse=new THREE.Vector2;e.raycaster=new THREE.Raycaster;e.mouseMoved=false;e.type="Editor";e.downloadWidth=3e3;e.downloadHeight=2e3;e.selectedFile=null;e.user=new n})(o);(function u(i){var n=i.stage=new e.Stage({canvas:t});n.showShadowMap=false;n.selectiveRendering=true;i.container=n.canvas.parent();var o=i.camera=n.camera;o.position.z=500;o.defaultPosition=new THREE.Vector3(o.position.x,o.position.y,o.position.z);var a=i.renderer=n.renderer;var s=i.orbitControl=n.orbitControl;var r=i.transformControls=new THREE.TransformControls(o,a.domElement);r.orbitControl=s;r.addEventListener("change",function(){i.selectionBox.update(r.object);i.stage.render()});n.add(r);s.addEventListener("change",function(){i.transformControls.update()});var l=i.selectionBox=new THREE.BoxHelper;l.material.depthTest=false;l.material.transparent=true;l.visible=false;n.add(l);var d=i.cloneSelection=new e.CloneBoxHelper(n);if(e.mode!==e.MODE.PLUGIN){o.position.y=450;o.position.z=150;s.maxPolarAngle=Math.PI/2}s.update();i.resize();if(n.showShadowMap){var u=this.dirLightShadowMapViewer=new THREE.ShadowMapViewer(n.spotLight);u.position.x=10;u.position.y=400;u.size.width=256;u.size.height=256;u.update()}})(o);(function c(t){(function n(e){if(deip.isApp){chrome.runtime.onSuspend.addListener(function(t){return e.beforeUnload(t)});chrome.app.window.onClosed.addListener(function(t){chrome.storage.local.set({autosave:e.toJSON()})})}else{window.addEventListener("beforeunload",function(t){return e.beforeUnload(t)},false)}window.addEventListener("resize",function(){e.resize()},false)})(t);(function o(t){var i=t.container;$("body").addClass(deip.isApp?"app":"browser");var n=$("<div class='webgl-download' title='Generate mockup image'>Generate Mockup<span class='image-size current'>"+t.downloadWidth+"px X "+t.downloadHeight+"px</span></div>");n.on("click",function(){t.download()});n.append().append($("<div id='image_sizes'>. . .<ul class='image-size-list'></ul></div>"));i.append(n);t.updateImageSize=function(e){t.downloadWidth=e.width;t.downloadHeight=e.height;$(".image-size.current").text(e.width+"px X "+e.height+"px");if(e.updateDB!==false){t.db.config.put({key:"imageSize",value:{width:e.width,height:e.height}}).then(function(){}).catch(function(e){console.log("Could not update imageSize to database:"+e.message)}).finally(function(){})}};var o=$(".image-size-list");var a=t.imageSizes;for(var s in a){var r=a[s];var l=r.width+"px X "+r.height+"px";var d=$('<li class="image-size-item">'+s+'<span class="image-size">'+l+"</span></li>");d.data("width",r.width).data("height",r.height);o.append(d);d.on("click",function(e){var i=$(this);t.updateImageSize({width:i.data("width"),height:i.data("height")})})}i.append($("<div class='webgl-preview'></div>"));var u=$("<div class='transform-controls-container'></div>");u.append($("<div class='controls-move transform-controls active'>Move</div>").on("click",function(){t.transformControls.setMode("translate");e.Editor.activate(".transform-controls",this)}));u.append($("<div class='controls-rotate transform-controls'>Rotate</div>").on("click",function(){t.transformControls.setMode("rotate");e.Editor.activate(".transform-controls",this)}));i.append(u);$("#purchase_link").attr("href",e.purchaselink)})(t);(function a(e){if(deip.isApp){if(e.addAppExplorer)e.addAppExplorer()}else{if(e.addExtensionExplorer)e.addExtensionExplorer()}})(t);l(t);s(t);r(t);(function d(e){e.gui=new dat.GUI;e.globalProperties=undef;e.objectProperties=undef;e.controls=undef;h(e);m(e);g(e);v(e)})(t);t.resize();if(i!==undef){t.presets=i;e.LoadTypes(t)}t.updateMenuPresets(t.selected);t.changeMode(1)})(o);(function p(t){window.addEventListener("mousemove",function(e){t.stage.renderRequestPending=true},false);t.renderer.domElement.addEventListener("mousewheel",function(e){t.stage.renderRequestPending=true},false);window.addEventListener("keyup",function(e){t.stage.renderRequestPending=true},false);(function i(e){var t=false,i=false,n=false;var o=16,a=17,s=18,r=83,l=86,d=67,u=69,c=71,p=78,f=79,h=46;var m=e.container.parent()[0];document.addEventListener("keydown",g,false);document.addEventListener("keyup",v,false);function g(m){if(m.srcElement.nodeName.toUpperCase()!=="BODY")return;switch(m.keyCode){case o:i=true;break;case a:t=true;break;case s:n=true;break;case r:if(t){e.menubar.fileMenu.saveToFileMenu.domElement.click();m.preventDefault()}break;case c:if(t){if(i){e.menubar.fileMenu.googleDriveFolder.domElement.click();m.preventDefault()}}break;case p:if(t){e.menubar.fileMenu.newMenu.domElement.click();m.preventDefault()}break;case f:if(t){if(i)e.menubar.fileMenu.loadServerMenu.domElement.click();else e.menubar.fileMenu.loadFileMenu.domElement.click();m.preventDefault()}break;case u:if(t){e.menubar.fileMenu.loadExamplesMenu.domElement.click();m.preventDefault()}break;case l:if(t)e.menubar.addMenu.addCopy.domElement.click();break;case d:if(t)e.menubar.addMenu.addClone.domElement.click();break;case h:e.menubar.addMenu.removeObject.domElement.click();break;default:break}}function v(e){switch(e.keyCode){case o:i=false;break;case a:t=false;break;case s:n=false;break;default:break}}})(t);(function n(t){var i=t.container;if(e.mode!==e.MODE.PLUGIN){t.renderer.domElement.addEventListener("click",a,false);t.renderer.domElement.addEventListener("dblclick",s,false);t.renderer.domElement.addEventListener("mousemove",n,false);t.renderer.domElement.addEventListener("mousedown",o,false)}function n(e){if(t.isMouseDown&&e.movementX!=0&&e.movementY!=0){t.isMouseMoving=true}}function o(e){document.activeElement.blur();t.mouseValue=e.pageX+","+e.pageY;t.isMouseMoving=false;t.isMouseDown=true}function a(i){t.isMouseDown=false;var n=i.pageX+","+i.pageY;if(t.isMouseMoving){}else if(n==t.mouseValue){i=i||window.event;i=$.event.fix(i);var o=t.mouse,a=t.raycaster;o.x=(i.pageX-t.stage.canvas.position().left)/t.stage.canvas.innerWidth()*2-1;o.y=-((i.pageY-t.stage.canvas.position().top)/t.stage.canvas.innerHeight())*2+1;a.setFromCamera(o,t.stage.camera);var s=a.intersectObjects(t.stage.children,true);if(s.length>0){var r,l=0;do{r=s[l].object;t.clickFace=s[l].face;l++;if(r.mockupParent!==void 0)break}while(r instanceof THREE.BoxHelper||!(r instanceof e.Paper));if(r.parent instanceof e.Bundle){r=r.parent}if(r.mockupParent!==void 0){r=r.mockupParent}if(r.userData&&r.userData.object!==undef){t.selectObject(r.userData.object)}else{t.selectObject(r)}}else{t.selectObject(null)}}t.stage.render()}function s(i){var n=t.selected;var o=t.clickFace;if(n.geometryType==e.GEOMETRY_TYPE.BOX){if(o.materialIndex==5){t.objectProperties.backImage.hiddenFileInput.click()}else{t.objectProperties.frontImage.hiddenFileInput.click()}}else{t.objectProperties.frontImage.hiddenFileInput.click()}deip.sendEvent("Double Click",deip.actionType,n.type)}})(t)})(o);(function f(t){var i=t.db=new Dexie("MockupStudio");i.version(1).stores({mockups:"id, name, user, timestamp, image, data,username,type",autosave:"id, data,timestamp",config:"key,value"});i.open().catch(function(e){console.log("Error opening database: "+e)});t.reset(false);if(deip.isApp){a(t)}else{i.on("ready",function(){i.autosave.count(function(e){if(e>0){i.autosave.get("0",function(e){if(e!==undef){t.reset();t.fromJSON(e.data);t.updateTitle()}t.quickstart.check()}).then(function(){console.log("restored")}).catch(function(e){console.error("Could not restore mockup from database: "+e.message)}).finally(function(){if(deip.isExtension)t.explorer.init()})}else{t.quickstart.check()}});i.config.get("imageSize",function(e){if(e!==undef){var i=e.value;if(i.width==undef){i.width=3e3;i.height=2e3}else i.updateDB=false;t.updateImageSize(i);console.log(i)}}).then(function(){}).catch(function(e){console.error("Could not restore imageSize from database: "+e.message)}).finally(function(){})})}e.autoSave=function(){t.autosave();t.stage.renderRequestPending=true}})(o)}function a(e){if(deip.isApp){chrome.storage.local.get("autosave",function(t){console.log("restored");if(t!==undef&&t.autosave!==undef){swal({title:"Restore last session!",text:"A last session data was detected. want to restore it?",type:"info",showCancelButton:true,confirmButtonColor:e.colors.green,confirmButtonText:"Restore",closeOnConfirm:true},function(i){if(i){e.fromJSON(t.autosave)}e.quickstart.check()})}else e.quickstart.check()})}else{var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(t===undefined){console.warn("AutoSave: IndexedDB not available.")}var i="mockup";var n=1;var o;var a=t.open(i,n);a.onupgradeneeded=function(e){var t=e.target.result;if(t.objectStoreNames.contains("autosave")===false){t.createObjectStore("autosave")}};a.onsuccess=function(t){o=t.target.result;if(o!==undefined){var i=o.transaction(["autosave"],"readwrite");var n=i.objectStore("autosave");var a=n.get(0);a.onsuccess=function(t){if(t.target.result!==undef){swal({title:"Restore last session!",text:"A last session data was detected. want to restore it?",type:"info",showCancelButton:true,confirmButtonColor:e.colors.green,confirmButtonText:"Restore",closeOnConfirm:true},function(i){if(i){e.fromJSON(t.target.result)}e.quickstart.check()})}else e.quickstart.check()}}e.database=o};a.onerror=function(e){console.error("Mockup: AutoSave IndexedDB",e)}}}function s(e){var t=e.titleBar=$("<div class='title-bar'></div>");var i,n,o,a,s,r;i=$("<div class='title-options app-minimize' title='Minimize'></div>");n=$("<div class='title-options app-restore' title='Restore Down'></div>");o=$("<div class='title-options app-maximize' title='Maximize'></div>");s=$("<div class='title-options app-close' title='Close'></div>");a=$("<div class= 'app-title'></div>");r=$("<div class='app-icon'></div>");e.container.parent().append(t);t.append(r);t.append(a);t.append(s);t.append(n);t.append(o);t.append(i);t.updateTitle=function(e){a.html(e)};i.on("click",function(){chrome.app.window.current().minimize()});o.on("click",function(){o.hide();n.show();chrome.app.window.current().maximize()});n.on("click",function(){o.show();n.hide();chrome.app.window.current().restore()});if(deip.isApp){chrome.app.window.onBoundsChanged.addListener(function(e){if(chrome.app.window.current().isMaximized()){o.show();n.hide()}else{o.hide();n.show()}})}s.on("click",function(){e.autosave(true);window.close()});window.onfocus=function(){$("body").removeClass("lostfocus")};window.onblur=function(){$("body").addClass("lostfocus")}}function r(t){var i=t.quickstart=$("<div class='explorer quick-start'></div>");var n,o,a,s,r;s=$("<div class='explorer-title'><div>Your Mockup scene looks empty?..</div><div>Select an example mockup from below to start with..</div></div>");r=$("<div class='explorer-close'>Cancel</div>");a=$('<ul class= "data"></ul>');var l=$('<a class="get-more" target="_blank" href="'+e.purchaselink+'">You can use and share unlimited free mockups with full version. GET NOW!!</a>');t.container.append(i);i.append(s);i.append(a);i.append(r);if(t.explorer==undef)i.append(l);var d=e.quickStart;t.createFileList(d,a,function(e,n){n=$(n);e.preventDefault();var o=n.find("a.files").attr("href");t.loadFile(o);deip.sendEvent("QuickStart",deip.actionType,o);i.hide()});r.on("click",function(){i.hide()});i.check=function(){var e=false;if(deip.isFull){e=t.stage.hasChild()}if(e==false)t.quickstart.fadeIn()}}function l(n){var o=n.menubar=new t;var a=n.container;var s=$(o.domElement);a.append(s);s.addClass("menubar");var r=deip.isFull=n.explorer!==undef;var l=r?"":" - Buy Now";deip.actionType=(deip.isApp?"App-":deip.isExtension?"Ext-":"Web-")+(r?"Normal":"Buy");$(o.domElement).on("click",function(e){var t=$(e.target);t=t.closest("div.panel");var i=$._data(t[0],"events");if(!t.hasClass("disabled")&&(i&&i.click)){deip.sendEvent("Menu",deip.actionType,$(t.find(".title")[0]).text())}});c(n,o);p(n,o);f(n,o);var u=o.loadExamplesMenu=new i("Mockup Examples",o);$(u.domElement).on("click",function(e){n.menubar.fileMenu.loadExamplesMenu.domElement.click()});if(!deip.isApp&&!deip.isExtension){var h=o.extensionMenu=new i("Get Chrome Addon",o);$(h.domElement).on("click",function(t){window.open(e.extensionlink,"_blank")})}var m=o.changeMode=new i("",o);$(m.domElement).on("click",function(e){n.changeMode(!n.previewMode)}).addClass("editor-mode");d(n,o)}function d(e,t){var i=$(t.domElement);var n=$('<div class="social"></div>');var o=$('<a class="social-link google-link" href="https://plus.google.com/b/102690169013229059021/102690169013229059021" target="_blank"></a>');var a=escape(window.location.origin);n=$(".quick-hint").html('<div class="social-title">Made by <a href="https://www.facebook.com/deipgroup/" target="_blank">DeipGroup</a>. Follow for updates:</div>');var s=$('<iframe class="twitter-follow" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=MockupStudioApp&show_screen_name=false&show_count=true&size=0"            title="Follow MockupStudioApp on Twitter"            width="80"   scrolling="no"         height="20"            style="border: 0; overflow: hidden;"            ></iframe>');n.append(s);var r=$('<iframe name="f2ee73c398" width="1000px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:share_button Facebook Social Plugin" src="https://www.facebook.com/v2.5/plugins/share_button.php?app_id=113869198637480&amp;channel=https%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df1584ade54%26domain%3Ddevelopers.facebook.com%26origin%3Dhttps%253A%252F%252Fdevelopers.facebook.com%252Ff32c92ccbc%26relation%3Dparent.parent&amp;container_width=613&amp;href=https%3A%2F%2Fwww.facebook.com%2FMockupStudioApp%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey" style="border: none; visibility: visible; " class="fb-like"></iframe>');n.append(r)}function u(e,t){if(!deip.isExtension)return;var n=t.userMenu=new i("Google Account",t);var o=n.signInMenu=new i("Sign In to Google",n,deip.isFull?"":"Buy Now!");$(o.domElement).on("click",function(t){if(deip.isExtension){if(o.disabled()==true)return;e.user.signIn(true).then(function(t){e.user.updateUser()})}else{e.purchase()}});o.disabled(!deip.isFull);var a=n.logOutMenu=new i("Sign Out from Google",n);$(a.domElement).on("click",function(t){e.user.signOut().then(function(){swal("Logged Out!","","success");e.user.updateUser()})}).hide();var s=n.setDirectory=new i("Choose Google Drive Directory",n);$(s.domElement).on("click",function(t){var i=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setIncludeFolders(!0).setMimeTypes("application/vnd.google-apps.folder").setMode(google.picker.DocsViewMode.LIST).setOwnedByMe(!0).setSelectFolderEnabled(!0);var n=(new google.picker.PickerBuilder).setTitle("Select Folder to Save Mockups").addView(i).setOAuthToken(e.user.token).setCallback(d).build();n.setVisible(true)});var r=t.loadGoogleDriveMenu;$(r.domElement).on("click",function(t){if(r.disabled())return;if(deip.isExtension){var i=new google.picker.DocsView(google.picker.ViewId.DOCS).setIncludeFolders(!0).setOwnedByMe(!0).setParent(e.user.folder.id).setSelectFolderEnabled(0).setMimeTypes("application/json, text/javascript, text/json, text/x-json");var n=(new google.picker.PickerBuilder).setTitle("Select Mockup file to load").addView(i).setOAuthToken(e.user.token).setCallback(d).build();n.setVisible(true)}else{e.getExtension()}});function l(e){if(e==true){$(a.domElement).hide();$(o.domElement).show();$(s.domElement).hide();r.disabled(true);n.value("");s.value("");r.value("");$(t.domElement).find(".login-profile-icon").remove()}else{$(a.domElement).show();$(o.domElement).hide();$(s.domElement).show();r.disabled(false)}$(n.domElement).hide();$(r.domElement).hide()}l(true);e.user.updateUser=function(){if(e.user.token==undef){l(true)}else{e.user.getProfile().then(function(){l(false);chrome.storage.sync.get("googleDriveFolder",function(t){if(t!==undef){e.user.folder=t.googleDriveFolder;u()}});a.value(e.user.name);n.value("Logged in as: "+e.user.name);$(t.domElement).find(".login-profile-icon").remove();$(t.domElement).prepend('<img class="login-profile-icon" src="'+e.user.imageUrl+'" title="Logged in as: '+e.user.name+'">')})}};function d(t){if(t[google.picker.Response.ACTION]==google.picker.Action.PICKED){var i=t[google.picker.Response.DOCUMENTS][0];var n={id:i[google.picker.Document.ID],name:i[google.picker.Document.NAME]};if(i.type=="folder"){e.user.folder=n;chrome.storage.sync.set({googleDriveFolder:e.user.folder});u()}else if(i.type=="file"){if(i.mimeType.indexOf("json")>-1){var o=gapi.client.request({path:"/drive/v2/files/"+n.id+"?alt=media",method:"GET",headers:{Authorization:"Bearer "+e.user.token}}).then(function(t){var i=t.result;function o(){swal.close();e.reset();e.user.file=n;e.currentFileName=n.name;e.updateTitle();e.fromJSON(i)}if(i.stage==void 0){i=JSON.parse(i)}if(i.stage==void 0){swal({title:"Invalid File...",text:"The selected file ('"+n.name+"') is invalid or currupted.",confirmButtonColor:e.colors.red,confirmButtonText:"Use File Anyway!",closeOnConfirm:true},function(e){if(e){o()}})}else{o()}},function(e){swal.close();console.log("Could not load file:"+e)});swal({title:"Loading data...",text:"Loading : "+n.name,showConfirmButton:false})}}}}function u(){s.value("Current Location: "+e.user.folder.name);r.value("Current Location: "+e.user.folder.name)}}function c(e,t){var n=t.fileMenu=new i("File",t);var o=n.newMenu=new i("New",n,"Ctrl+N");$(o.domElement).on("click",function(){if(o.disabled())return;e.changeMode(false);e.newFile()});var a=deip.isFull=e.explorer!==undef;var s=a?"":" - Buy Now";deip.sendEvent("App",deip.actionType,(deip.isApp?"App-":"Web-")+"Load");var r;if(deip.isApp){r=n.loadFileMenu=new i("Load Mockup File",n,a?"Ctrl+O":"Buy Now!");$(r.domElement).on("click",function(t){e.openFile()})}else{r=n.loadFileMenu=new i("Load Mockup File",n,a?"Ctrl+O":"Buy Now!");$(r.domElement).on("click",function(t){e.openFile()});n.addSeparator();var l=n.loadGoogleDriveMenu=new i("Load from Google Drive",undef,a?"Ctrl+Shift+G":"Buy Now!")}var d=n.loadExamplesMenu=new i("Mockup Examples",n,"Ctrl+E");$(d.domElement).on("click",function(t){e.quickstart.show()});n.addSeparator();var c=n.saveToFileMenu=new i("Save to File",n,a?"Ctrl+S":"Buy Now!");$(c.domElement).on("click",function(t){if(c.disabled())return;e.saveToFile(true)});n.addSeparator();u(e,n)}function p(t,n){var o=n.addMenu=new i("Add",n);var a=o.addCopy=new i("Copy",o,"Ctrl+V");$(a.domElement).on("click",function(e){if(!a.disabled()&&!o.disabled()){if(t.selected==undef)return;var i=t.selected.createCopy();t.changeMode(false);t.stage.add(i);t.selectObject(i)}});var s=o.addClone=new i("Clone",o,"Ctrl+C");$(s.domElement).on("click",function(e){if(!s.disabled()&&!o.disabled()){if(t.selected==undef)return;var i=t.selected.createClone();t.changeMode(false);t.stage.add(i);t.selectObject(i)}});var r=o.removeObject=new i("Delete Object",o,"Delete");$(r.domElement).on("click",function(e){if(!r.disabled()&&!o.disabled()){if(t.selected==undef)return;swal({title:"Delete?",text:"Delete the current object?",type:"warning",showCancelButton:true,confirmButtonColor:t.colors.red,confirmButtonText:"Delete it!",closeOnConfirm:true},function(e){if(e){t.changeMode(false);var i=t.selected;var n=t.stage.getIndexesByProperty("cloneParent",i.uuid);if(n.length>1){var o=t.stage.children[n[0]].uuid;t.stage.children[n[0]].cloneParent=undef;for(var a=1;a<n.length;a++){var s=t.stage.children[n[a]];s.cloneParent=o}}t.stage.remove(t.selected);t.selectObject(null)}})}});o.addSeparator();for(var l in e.presets){if(l!=="options"){var d=e.presets[l];var u=d.menu;if(u!=undef&&u!=={}){var c=o["add"+l]=new i(u.name,o);var p=u.subMenu;if(p!==undef&&p!=={}){for(var f in p){var h=p[f];if(h!==undef&&h!=={}){var m=new i(h.name,c);$(m.domElement).on("click",function(){if(o.disabled())return;var i=$(this).data("class");var n=i.split(".")[0];var a=i.split(".")[1];var s=$.extend({},e.presets[n].options,e.presets[n].menu.subMenu[a].options);s.subType=a;t.changeMode(false);t.addNew(n,s)});$(m.domElement).data("class",l+"."+f);if(h.addSeperator)c.addSeparator()}}}if(u.addSeperator)o.addSeparator()}}}}function f(t,n){var o=n.helpMenu=new i("Help",n);var a=e.Help.subMenu;if(a!==undef&&a!=={}){for(var s in a){var r=a[s];if(r!==undef&&r!=={}){var l=new i(r.name,o);var d=r.url;$(l.domElement).on("click",function(){var e=$(this).data("url");window.open(e,"_blank")});$(l.domElement).data("url",d);if(r.addSeperator)o.addSeparator()}}}}function h(t){var i=t.controls=new function(){var n=this.defaults={shadowDarkness:.3,shadowBlur:5,lightPosition:310,ambient:.5,lightIntensity:.6,lightRadius:1e3,lightHeight:1e3,softShadow:false,showLightHelper:false};this.reset=function(){var e=t.globalProperties;e.lightIntensity.setValue(n.lightIntensity);e.ambient.setValue(n.ambient);e.shadowDarkness.setValue(n.shadowDarkness);e.lightPosition.setValue(n.lightPosition);e.lightRadius.setValue(n.lightRadius);e.lightHeight.setValue(n.lightHeight);e.softShadow.setValue(n.softShadow);e.showLightHelper.setValue(n.showLightHelper)};this.width=297;this.height=210;this.foldAngle1=30;this.foldAngle2=120;this.shadowDarkness=n.shadowDarkness;this.shadowBlur=n.shadowBlur;this.lightPosition=n.lightPosition;this.stiffness=.02;this.ambient=n.ambient;this.lightIntensity=n.lightIntensity;this.bumpSize=.4;this.shininess=30;this.lightRadius=n.lightRadius;this.lightHeight=n.lightHeight;this.softShadow=n.softShadow;this.showLightHelper=n.showLightHelper;this.repeat=100;this.screenSize=5;this.resolutionHeight=1920;this.resolutionWidth=1080;this.updateWidth=function(){if(t.skipPropertyUpdate==true)return;var n=t.getSelectedTarget();if(n instanceof e.Ground)return;if(n.widthScale==i.width/n.width){return}if(n.updateAngle!==undef){n.width=i.width;n.updateAngle();t.selectionBox.update(t.defaultObject)}else{n.widthScale=i.width/n.width;n.scale.x=n.widthScale;t.selectionBox.update(t.defaultObject)}};this.updateHeight=function(){if(t.skipPropertyUpdate==true)return;var n=t.getSelectedTarget();if(n instanceof e.Ground)return;if(n.heightScale==i.height/n.height)return;n.heightScale=i.height/n.height;n.scale.y=n.heightScale;t.selectionBox.update(t.defaultObject)};this._updateUIDimension=function(t){if(t instanceof e.Ground)return;t.screenSize=e.inchTomm(i.screenSize);t.resolutionHeight=i.resolutionHeight;t.resolutionWidth=i.resolutionWidth;var n=t.resolutionHeight/t.resolutionWidth;var o=t.screenSize*n/Math.sqrt(n*n+1);var a=o/n;if(i.screenSize<=1){var s=t.material.materials[4].map.naturalHeight;var r=t.material.materials[4].map.naturalWidth;if(s!==undef&&r!==undef){o=s/10;a=r/10}}t.widthScale=a/t.width;t.scale.x=t.widthScale;t.heightScale=o/t.height;t.scale.y=t.heightScale};this.updateUIDimension=function(){if(t.skipPropertyUpdate==true)return;var e=t.getSelectedTarget();if(e!==undef){i._updateUIDimension(e)}t.selectionBox.update(t.defaultObject)};this.updateAngle=function(){if(t.skipPropertyUpdate==true)return;var e=t.getSelectedTarget();if(e!==undef&&e.angles!==undef){if(e.angles[1]==i.foldAngle1&&e.angles[4]==i.foldAngle2&&e.stiffness==i.stiffness)return;e.angles=[0,i.foldAngle1,0,0,i.foldAngle2,0];e.stiffness=i.stiffness;if(e.updateAngle!==undef){e.updateAngle();t.selectionBox.update(t.defaultObject)}}};this.enableSoftShadow=function(){t.stage.enableSoftShadow(i.softShadow)};this.enableLightHelper=function(){t.stage.spotLightHelper.visible=i.showLightHelper};this.updateShininess=function(){var e=t.getSelectedTarget();if(e.shininess!==undef)e.shininess(i.shininess)};this.updateLightDarkness=function(){t.stage.spotLight.shadowDarkness=i.shadowDarkness};this.updateShadowBlur=function(){t.stage.spotLight.shadowBlur=i.shadowBlur};this.updateAmbient=function(){var e=Math.floor(i.ambient*255);t.stage.ambientLight.color=new THREE.Color("rgb("+e+","+e+","+e+")")};this.updateLightIntensity=function(){t.stage.spotLight.intensity=i.lightIntensity};this.updateLightPosition=function(){var e=i.lightRadius;var n=i.lightHeight;var o=i.lightPosition*Math.PI/180;var a=t.stage.spotLight;a.radius=e;a.position.x=a.radius*Math.cos(o);a.position.z=a.radius*Math.sin(o);a.position.y=n;a.lookAt(new THREE.Vector3(0,0,0))};this.backImage=function(){t.objectProperties.backImage.hiddenFileInput.click()};this.frontImage=function(){t.objectProperties.frontImage.hiddenFileInput.click()};this.updateBumpSize=function(){var e=t.getSelectedTarget();if(e.bumpScale!==undef)e.bumpScale(i.bumpSize)};this.updateRepeat=function(){var e=t.getSelectedTarget();if(e.textureRepeat!==undef)e.textureRepeat(i.repeat)}};dat.controllers.NumberControllerBox.prototype.setVisibility=dat.controllers.BooleanController.prototype.setVisibility=dat.controllers.ColorController.prototype.setVisibility=dat.controllers.FunctionController.prototype.setVisibility=dat.controllers.NumberControllerBox.prototype.setVisibility=dat.controllers.NumberControllerSlider.prototype.setVisibility=dat.controllers.OptionController.prototype.setVisibility=dat.controllers.StringController.prototype.setVisibility=dat.controllers.Controller.prototype.setVisibility=function(e){var t=$(this.domElement).closest("li");if(e){t.show()}else{t.hide()}return this};dat.controllers.NumberControllerBox.prototype.setText=dat.controllers.BooleanController.prototype.setText=dat.controllers.ColorController.prototype.setText=dat.controllers.FunctionController.prototype.setText=dat.controllers.NumberControllerBox.prototype.setText=dat.controllers.NumberControllerSlider.prototype.setText=dat.controllers.OptionController.prototype.setText=dat.controllers.StringController.prototype.setText=dat.controllers.Controller.prototype.setText=dat.controllers.Controller.prototype.setText=function(e){$(this.domElement).closest("li").find(".property-name").text(e);return this}}function m(t){var i=t.controls;var n=t.globalProperties=t.gui.addFolder("Global Properties");n.lightIntensity=n.add(i,"lightIntensity",0,1).step(.01).onChange(i.updateLightIntensity).setText("Light Intensity");
n.ambient=n.add(i,"ambient",0,1).step(.01).onChange(i.updateAmbient).setText("Ambience");n.lightPosition=n.add(i,"lightPosition",0,360).min(0).step(1).onChange(i.updateLightPosition).setText("Light Position(Angle)");n.lightRadius=n.add(i,"lightRadius",0,2e3).min(0).step(1).onChange(i.updateLightPosition).setText("Light Position(Radius)");n.lightHeight=n.add(i,"lightHeight",0,5e3).min(10).step(1).onChange(i.updateLightPosition).setText("Light Position(Height)");n.showLightHelper=n.add(i,"showLightHelper").onChange(i.enableLightHelper).setText("Enable Light Helper");n.shadowDarkness=n.add(i,"shadowDarkness",0,.99).min(0).step(.01).onChange(i.updateLightDarkness).setText("Shadow Darkness");n.shadowBlur=n.add(i,"shadowBlur",0,10).min(0).step(.01).onChange(i.updateShadowBlur).setText("Shadow Blur");n.softShadow=n.add(i,"softShadow").onChange(i.enableSoftShadow).setText("Enable Preview(Slow)");if(deip.isFull!=false)n.open();n.lightIntensity.setValue(i.defaults.lightIntensity);n.lightPosition.setValue(i.defaults.lightPosition);n.ambient.setValue(i.defaults.ambient);n.shadowDarkness.setValue(i.defaults.shadowDarkness);if(e.mode==e.MODE.PLUGIN){n.shadowDarkness.setVisibility(false);n.lightPosition.setValue(110);n.ambient.setValue(i.defaults.ambient)}}function g(t){var i=t.controls;var n=t.objectProperties=t.gui.addFolder("Object Properties");n.width=n.add(i,"width",20).step(.1).onChange(i.updateWidth).setText("Width");n.height=n.add(i,"height",20).step(.1).onChange(i.updateHeight).setText("Height");n.screenSize=n.add(i,"screenSize",1,17).step(.1).onChange(i.updateUIDimension).setText("Screen Size");n.resolutionWidth=n.add(i,"resolutionWidth",240).step(.1).onChange(i.updateUIDimension).setText("Resolution Width");n.resolutionHeight=n.add(i,"resolutionHeight",240).step(.1).onChange(i.updateUIDimension).setText("Resolution Height");n.foldAngle1=n.add(i,"foldAngle1",0,180).step(.5).onChange(i.updateAngle).setText("First Fold Angle");n.foldAngle2=n.add(i,"foldAngle2",0,180).onChange(i.updateAngle).setText("Second Fold Angle");n.shininess=n.add(i,"shininess",0,100).step(1).onChange(i.updateShininess).setText("Gloss");n.stiffness=n.add(i,"stiffness",0,1).step(.01).onChange(i.updateAngle).setText("Paper Flexibility");n.bumpSize=n.add(i,"bumpSize",0,5).step(.1).onChange(i.updateBumpSize).setText("Texture Bump Size");n.repeat=n.add(i,"repeat",1,500).step(5).onChange(i.updateRepeat).setText("Texture Repeat");n.backImage=n.add(i,"backImage").setText("Change Back Image");n.frontImage=n.add(i,"frontImage").setText("Change Front Image");if(deip.isFull!=false)n.open();var o=function(e,t,n){if(t=="frontImage"){e.frontImage(n,function(e){if(e.screenSize!==undef){i._updateUIDimension(e)}})}else{e.backImage(n)}};var a=function(i){i.hiddenFileInput=$("<input type='file' class='hidden-input' accept='image/*'>");$(i.domElement).append(i.hiddenFileInput);i.hiddenFileInput.change(function(){var n=i.hiddenFileInput[0].files;var a;if(n.length){a=n[0];a.upload={progress:0,total:a.size,bytesSent:0};var s=t.getSelectedTarget();var r="textures/"+a.lastModified+"."+a.size;e.checkFile(r,function(){i.hiddenFileInput.val("");o(s,i.property,r)},function(){var t;t=new FileReader;t.onload=function(n){return function(){i.hiddenFileInput.val("");var n=t.result;e.needSave=true;e.saveFileName=r;o(s,i.property,n)}}(a);t.readAsDataURL(a)})}})};a(n.frontImage);a(n.backImage)}function v(e){if(window.mockupTips!==undef){var t=$(e.objectProperties.domElement).parent().parent();for(var i=0;i<window.mockupTips.length;i++){var n=window.mockupTips[i];var o=$("<div>",{"class":"mockup-tips"+(i==0?" active-tip":""),on:{click:function(){var e=$(this).removeClass("active-tip");var t=e.parent();var i=e.next();if(i.length==0)i=t.find(".mockup-tips:first");i.addClass("active-tip")}},html:n}).appendTo(t)}}}o.prototype.getNewFileName=function(){return this.untitledFileName};o.prototype.selectObject=function(t){if(this.selected===t)return;var i=null;if(t)i=t.uuid;this.selected=t;this.selectionBox.visible=false;this.transformControls.detach();if(t){if(t.geometry!==undef&&t instanceof THREE.Sprite===false){this.selectionBox.update(t);this.selectionBox.visible=true}else if(t instanceof e.Bundle){this.selectionBox.update(t);this.selectionBox.visible=true}this.defaultObject=t;if(this.previewMode!=true)this.transformControls.attach(t);this.cloneSelection.selectClones(t)}else this.cloneSelection.selectClones(this.stage.ground);this.updateControls(t);this.updateMenuPresets(t);this.stage.renderRequestPending=true};o.prototype.updateControls=function(t){if(t instanceof e.Bundle){t=t.mainObject}var i=t!==undef&&t!==null;var n=i&&!(t.type=="Ground"||t.type=="UI")&&t instanceof e.Paper;this.skipPropertyUpdate=true;var o=this.objectProperties;o.width.setVisibility(n);o.height.setVisibility(n);o.foldAngle1.setVisibility(i&&t.updateAngle!==undef);o.foldAngle2.setVisibility(i&&t.updateAngle!==undef);o.stiffness.setVisibility(i&&t.updateAngle!==undef);o.backImage.setVisibility(i&&t.backImage!==undef);o.repeat.setVisibility(i&&t.textureRepeat!==undef);o.shininess.setVisibility(i&&t.shininess!==undef);o.bumpSize.setVisibility(i&&t.bumpScale!==undef);o.frontImage.setVisibility(i&&t.frontImage!==undef);o.backImage.setVisibility(i&&t.backImage!==undef);o.resolutionHeight.setVisibility(i&&t.resolutionHeight!==undef);o.resolutionWidth.setVisibility(i&&t.resolutionWidth!==undef);o.screenSize.setVisibility(i&&t.screenSize!==undef);if(i){if(n){o.width.setValue(t.width*t.widthScale);o.height.setValue(t.height*t.heightScale)}o.stiffness.setValue(t.stiffness);if(t.updateAngle!==undef){o.foldAngle1.setValue(t.angles[1]);o.foldAngle2.setValue(t.angles[4])}if(t.geometryType!==undef){if(t.geometryType==e.GEOMETRY_TYPE.BOX){if(t.bumpScale)o.bumpSize.setValue(t.material.materials[4].bumpScale);if(t.shininess)o.shininess.setValue(t.material.materials[4].shininess)}else{o.bumpSize.setValue(t.material.bumpScale);o.shininess.setValue(t.material.shininess)}}if(t.type=="Ground"){o.repeat.setValue(t.textureRepeat())}else if(t instanceof e.FoldBoxPaper){}else if(t instanceof e.UI){o.resolutionHeight.setValue(t.resolutionHeight);o.resolutionWidth.setValue(t.resolutionWidth);o.screenSize.setValue(e.mmToInch(t.screenSize))}}this.skipPropertyUpdate=false};function w(){$(".nav-item[data-type='none']").trigger("click")}o.prototype.updateUser=function(e){};o.prototype.updateMenuPresets=function(e){if(e==undef||e==null){w();return}var t=e.type;var i=$(".nav-item[data-type='"+t+"']");if(i.length>0)i.trigger("click");else w();editor.menubar.addMenu.addCopy.disabled(t=="Ground");editor.menubar.addMenu.addClone.disabled(t=="Ground");editor.menubar.addMenu.removeObject.disabled(t=="Ground")};o.prototype.getSelectedTarget=function(){if(this.transformControls.object==undef)return this.defaultObject;else return this.transformControls.object};o.prototype.download=function(e,t,i,n){if(e==undef||t==undef){e=this.downloadWidth;t=this.downloadHeight}var o;var a=this;a.selectObject(null);if(i==undef){swal({title:"Please Wait!",text:"Generating Image",showConfirmButton:false});setTimeout(function(){var i=a.stage.spotLightHelper.visible;a.stage.spotLightHelper.visible=false;if(e<=a.testWidth){a.stage.resizeCanvas(e*2,t*2);if(!a.controls.softShadow)a.stage.enableSoftShadow(true);a.stage.render();var n=document.createElement("canvas");n.width=e;n.height=t;var o=n.getContext("2d");o.drawImage(a.renderer.domElement,0,0,e*2,t*2,0,0,e,t);n.toBlob(function(e){saveAs(e,"mockup.jpg")},"image/jpeg",a.imageQuality)}else{a.stage.resizeCanvas(e,t);if(!a.controls.softShadow)a.stage.enableSoftShadow(true);a.stage.render();a.renderer.domElement.toBlob(function(e){saveAs(e,"mockup.jpg")},"image/jpeg",a.imageQuality)}a.resize();a.selectObject(a.defaultObject);if(!a.controls.softShadow)a.stage.enableSoftShadow(false);swal.close();a.stage.spotLightHelper.visible=i},50)}else{var s=a.stage.spotLightHelper.visible;a.stage.spotLightHelper.visible=false;this.stage.resizeCanvas(e,t);this.renderer.render(this.stage,this.camera);if(n==undef){o=this.renderer.domElement.toDataURL("image/png",a.thumbnailQuality)}else{a.renderer.domElement.toBlob(function(e){n(e)},"image/jpeg",a.imageQuality)}a.resize();a.selectObject(a.defaultObject);a.stage.spotLightHelper.visible=s;if(n==undef)return o}deip.sendEvent("Buttons",deip.actionType,"Get Image")};o.prototype.purchase=function(){var e=this;swal({title:"This function requires Full Extension version!",text:"Loading and Saving are limited in web mode. You need a full version of Mockup Studio Chrome Extension. You can get it from CodeCanyon",type:"warning",showCancelButton:true,confirmButtonColor:e.colors.blue,confirmButtonText:"Get it Now!",closeOnConfirm:true},function(e){if(e){$("#purchase_link")[0].click();deip.sendEvent("Buttons",deip.actionType,"Buy It")}})};o.prototype.getExtension=function(){var e=this;swal({title:"This function is available on Chrome Extension!",text:"You can get it from WebStore",type:"warning",showCancelButton:true,confirmButtonColor:e.colors.blue,confirmButtonText:"Get it Now!",closeOnConfirm:true},function(e){if(e){$("#extension_link")[0].click();deip.sendEvent("Buttons",deip.actionType,"Get Extension")}})};o.prototype.resize=function(){if(this.menubar!==undef&&this.globalProperties!==undef){var e=this.container.height()-$(this.menubar.domElement).height();var t=this.container.width()-$(this.globalProperties.domElement).width();this.stage.resizeCanvas(t,e)}};o.prototype.beforeUnload=function(e){var t=this;t.autosave(true);swal({title:"Auto close alert!",text:"Saving data.",timer:2e3,showConfirmButton:false});return false};o.prototype.addNew=function(t,i){var n=e.presets[t];i=$.extend({},n==undef?{}:n.options,i);var o=new e[t](i,this.stage);if(o.geometry){this.stage.add(o);this.selectObject(o);$(".menu-item:first-child").trigger("click");this.autosave()}};o.prototype.newFile=function(){var e=this;swal({title:"Unsaved Data!!",text:"You will loose any unsaved data. Continue?",type:"warning",showCancelButton:true,confirmButtonColor:e.colors.blue,confirmButtonText:"Create New!",closeOnConfirm:true},function(t){if(t){e.reset()}})};o.prototype.changeMode=function(e){if(e==true){this.container.addClass("preview");this.transformControls.visible=false;this.transformControls.detach();this.previewMode=true}else{this.container.removeClass("preview");this.previewMode=false;this.transformControls.visible=true;if(this.selected)this.transformControls.attach(this.selected)}this.stage.renderRequestPending=true};o.prototype.updateTitle=function(){var e=this.currentFileName;if(e){this.titleBar.updateTitle(e+" - MOCKUP Studio")}};o.prototype.clearChild=function(e){var t=e.material;e.parent.remove(e);var i;if(e.dispose!==undef)e.dispose();if(e.geometry!==undef)e.geometry.dispose();if(t==undef)return;if(t.materials==undef){if(t.map){i=t.map;t.dispose();i.dispose()}if(t.bumpMap){i=t.bumpMap;t.dispose();i.dispose()}}else{for(var n=0;n<t.materials.length;n++){if(t.materials[n]){if(t.materials[n].map){i=t.materials[n].map;t.materials[n].dispose();i.dispose()}if(t.materials[n].bumpMap){i=t.materials[n].bumpMap;t.materials[n].dispose();i.dispose()}}t.materials[n]=null}}t=null;i=null};o.prototype.reset=function(t){var i=this;this.selectObject(null);this.currentFileName=this.getNewFileName();this.updateTitle();var n=this.stage;function o(i){if(t==undef||t==true){e.clearChild(i)}}var a=n.children.length;for(var s=a-1;s>=0;s--){var r=n.children[s];if(r===n.ground){if(r.material.map&&r.material.map.sourceFile!==e.defaults.groundTexture&&t!==false){r.material.map.dispose();r.material.bumpMap.dispose();r.frontImage(e.defaults.groundTexture)}r.material.shininess=e.paperDefaults.shininess;r.material.bumpScale=.1;r.textureRepeat(e.paperDefaults.repeat);r.position.set(0,-1,0);r.rotation.set(-Math.PI/2,0,0)}else if(r===this.stage.spotLight){}else if(r===this.stage.ambientLight){}else if(r instanceof THREE.TransformControls){}else if(r instanceof THREE.CameraHelper){if(r!=this.stage.spotLightHelper)o(r)}else if(r instanceof THREE.BoxHelper){}else if(r instanceof e.Bundle){for(var l=r.children.length-1;l>=0;l--){o(r.children[l])}r.parent.remove(r)}else{o(r)}}this.stage.camera.position.set(-300,300,300);this.stage.camera.lookAt(new THREE.Vector3(0,0,0));this.orbitControl.center.set(0,0,0);this.orbitControl.update();this.controls.reset();this.selectObject(null);this.stage.clearMaterials();this.cloneSelection.cloneHelpers=[];this.stage.render();if(t==undef||t==true)this.clearAutoSave();if(i.user)i.user.file=undef};var b;var k=function(e){var t=performance.now();var i=e.toJSON();var n=function(e){console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+"]","Saved state to IndexedDB. "+(performance.now()-t).toFixed(2)+"ms")};e.db.autosave.put({data:i,timestamp:Math.floor(Date.now()),id:"0"}).then(function(){n()}).catch(function(e){console.error("Could not autosave to database:"+e.message)}).finally(function(){})};o.prototype.autosave=function(e){var t=this;clearTimeout(b);if(e){k(t)}else{b=setTimeout(function(){b=setTimeout(k,100,t)},1e3)}};o.prototype.clearAutoSave=function(){if(deip.isApp){chrome.storage.local.set({autosave:undef},function(){})}else{editor.db.autosave.delete("0").then(function(){console.log("AutoSave Cleared.")}).catch(function(e){console.error("Could not autosave to database:"+e.message)}).finally(function(){})}};o.prototype.fromJSON=function(e){var t=new THREE.ObjectLoader;if(e.stage==undefined){var i=t.parse(e);this.setStage(i);return}var n=t.parse(e.camera);this.camera.position.copy(n.position);this.camera.rotation.copy(n.rotation);this.camera.aspect=n.aspect;this.camera.near=n.near<1?4:n.near;this.camera.far=n.far;if(e.camera.controlsCenter){var o=e.camera.controlsCenter;this.orbitControl.center.set(o.x,o.y,o.z);this.orbitControl.update()}var a=this.globalProperties;if(e.project.lightIntensity)a.lightIntensity.setValue(e.project.lightIntensity);if(e.project.ambient)a.ambient.setValue(e.project.ambient);if(e.project.shadowDarkness)a.shadowDarkness.setValue(e.project.shadowDarkness);if(e.project.shadowBlur)a.shadowBlur.setValue(e.project.shadowBlur);if(e.project.lightPosition)a.lightPosition.setValue(e.project.lightPosition);if(e.project.lightRadius)a.lightRadius.setValue(e.project.lightRadius);if(e.project.lightHeight)a.lightHeight.setValue(e.project.lightHeight);this.setStage(t.parse(e.stage));this.selectObject(this.stage.ground);this.scripts=e.scripts};o.prototype.toJSON=function(){var e=this.controls;var t=this.camera.toJSON();t.controlsCenter=this.orbitControl.center.clone();return{project:{vr:false,lightIntensity:e.lightIntensity,lightHeight:e.lightHeight,lightRadius:e.lightRadius,lightPosition:e.lightPosition,shadowDarkness:e.shadowDarkness,shadowBlur:e.shadowBlur,ambient:e.ambient},camera:t,stage:this.stage.toJSON(),scripts:this.scripts}};o.prototype.openFile=function(){this.purchase()};o.prototype.saveFile=function(){this.purchase()};o.prototype.saveToFile=function(){var e=this;var t=this.download(240,160,true,function(t){var i=new Blob([t,JSON.stringify(e.toJSON())],{type:"image/jpg"});saveAs(i,"mockup.ms.jpg")})};o.prototype.loadFile=function(e){var t=this;$.get(e+"?"+Math.random(),function(i){if(i.stage==undef){i=t.readFormat(i,e)}if(i!==undef){t.reset();t.fromJSON(i)}})};o.prototype.readFormat=function(e,t){var i="";if(e.indexOf('{"project":{')==0){return JSON.parse(e)}var n=e.indexOf('{"project":{');if(n>-1){i=e.substr(n);return JSON.parse(i)}else{swal({title:"Invalid File...",text:"The selected file "+t+"is invalid or currupted.",confirmButtonColor:editor.colors.red,closeOnConfirm:true},function(e){if(e){}});return undef}};o.prototype.setStage=function(t){this.stage.uuid=t.uuid;this.stage.name=t.name;this.stage.userData=JSON.parse(JSON.stringify(t.userData));while(t.children.length>0){var i=t.children[0];if(i instanceof e.Ground){e.clearChild(this.stage.ground);i.widthScale=1;i.heightScale=1;i.scale.x=1;i.scale.y=1;this.stage.add(i);this.stage.ground=i}else if(i instanceof THREE.SpotLight||i instanceof THREE.AmbientLight||i instanceof THREE.PerspectiveCamera||i.type=="Object3D"||i instanceof THREE.CameraHelper){e.clearChild(i)}else{this.stage.add(i);i.skipLoad=false;if(i.cloneParent!==undef){var n=this.stage.getObjectByUuid(i.cloneParent);if(n!==undef&&n.type==i.type){i.material=n.material}}}}};o.activate=function(e,t,i){if(!i){i="active"}if(e){$(e).removeClass(i)}if(t){$(t).addClass(i)}};o.prototype.createFileList=function(e,t,i){for(var n in e){var o=e[n];var a=$('<li class="files"><a href="'+o+'" title="'+n+'" class="files" style="background-image:url(\''+o+'?\')"><span class="name">'+n+"</span></a></li>");t.append(a);a.on("click",function(e){if(i!==void 0)i(e,this)})}};return o}({})})(MOCKUP||(MOCKUP={}));